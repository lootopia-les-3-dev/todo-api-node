{
  "openapi": "3.0.0",
  "info": {
    "title": "Todo API",
    "version": "1.0.0",
    "description": "A production-ready REST API for managing todos.\n\n## Features\n- Full CRUD on todos\n- Pagination (`skip` / `limit`) on list\n- Full-text search on title (LIKE)\n- Input validation via Zod (structured error arrays)\n- SQLite persistence via sql.js\n\n## Status values\n| Value | Meaning |\n|-------|---------|\n| `pending` | Not started yet (default) |\n| `in-progress` | Currently being worked on |\n| `done` | Completed |",
    "contact": {
      "name": "lootopia-les-3-dev",
      "url": "https://github.com/lootopia-les-3-dev/todo-api-node"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local development"
    }
  ],
  "tags": [
    {
      "name": "System",
      "description": "Health check et informations de l'API"
    },
    {
      "name": "Todos",
      "description": "Opérations CRUD sur les todos"
    }
  ],
  "components": {
    "schemas": {
      "Todo": {
        "type": "object",
        "description": "Un todo stocké en base de données",
        "required": [
          "id",
          "title",
          "status"
        ],
        "properties": {
          "id": {
            "type": "integer",
            "description": "Identifiant unique auto-incrémenté, généré par la BDD",
            "example": 42,
            "readOnly": true
          },
          "title": {
            "type": "string",
            "description": "Titre court de la tâche (1–200 caractères)",
            "minLength": 1,
            "maxLength": 200,
            "example": "Buy groceries"
          },
          "description": {
            "type": "string",
            "description": "Description longue optionnelle (max 1000 caractères). Peut être null.",
            "maxLength": 1000,
            "nullable": true,
            "example": "Oat milk, sourdough bread, eggs"
          },
          "status": {
            "type": "string",
            "description": "Statut actuel du cycle de vie du todo",
            "enum": [
              "pending",
              "in-progress",
              "done"
            ],
            "default": "pending",
            "example": "in-progress"
          }
        },
        "example": {
          "id": 42,
          "title": "Buy groceries",
          "description": "Oat milk, sourdough bread, eggs",
          "status": "in-progress"
        }
      },
      "CreateTodoBody": {
        "type": "object",
        "description": "Payload pour créer un nouveau todo. Seul `title` est obligatoire.",
        "required": [
          "title"
        ],
        "properties": {
          "title": {
            "type": "string",
            "description": "Titre de la tâche (1–200 caractères)",
            "minLength": 1,
            "maxLength": 200,
            "example": "Finish the project report"
          },
          "description": {
            "type": "string",
            "description": "Détails optionnels sur la tâche (max 1000 caractères)",
            "maxLength": 1000,
            "nullable": true,
            "example": "Include Q3 metrics and executive summary"
          },
          "status": {
            "type": "string",
            "description": "Statut initial — `pending` si omis",
            "enum": [
              "pending",
              "in-progress",
              "done"
            ],
            "default": "pending",
            "example": "pending"
          }
        },
        "example": {
          "title": "Finish the project report",
          "description": "Include Q3 metrics and executive summary",
          "status": "pending"
        }
      },
      "UpdateTodoBody": {
        "type": "object",
        "description": "Payload de mise à jour partielle. Seuls les champs fournis sont modifiés.",
        "minProperties": 1,
        "properties": {
          "title": {
            "type": "string",
            "description": "Nouveau titre (1–200 caractères)",
            "minLength": 1,
            "maxLength": 200,
            "example": "Buy organic groceries"
          },
          "description": {
            "type": "string",
            "description": "Nouvelle description (max 1000 caractères). Passer `null` pour l'effacer.",
            "maxLength": 1000,
            "nullable": true,
            "example": "From the farmers market only"
          },
          "status": {
            "type": "string",
            "description": "Nouvelle valeur de statut",
            "enum": [
              "pending",
              "in-progress",
              "done"
            ],
            "example": "done"
          }
        },
        "example": {
          "status": "done"
        }
      },
      "ValidationError": {
        "type": "object",
        "description": "Retourné quand le body ou les query params échouent la validation Zod.",
        "properties": {
          "detail": {
            "description": "Tableau d'issues Zod — chaque issue a un `path` et un `message`",
            "oneOf": [
              {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "title"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "example": "String must contain at least 1 character(s)"
                    }
                  }
                }
              },
              {
                "type": "string"
              }
            ],
            "example": [
              {
                "path": [
                  "title"
                ],
                "message": "Required"
              },
              {
                "path": [
                  "status"
                ],
                "message": "Invalid enum value. Expected 'pending' | 'in-progress' | 'done'"
              }
            ]
          }
        }
      },
      "Error": {
        "type": "object",
        "description": "Réponse d'erreur générique",
        "properties": {
          "detail": {
            "type": "string",
            "description": "Message d'erreur lisible par un humain",
            "example": "Todo not found"
          }
        },
        "example": {
          "detail": "Todo not found"
        }
      }
    },
    "parameters": {
      "TodoId": {
        "in": "path",
        "name": "id",
        "required": true,
        "description": "ID numérique du todo",
        "schema": {
          "type": "integer",
          "minimum": 1,
          "example": 42
        }
      }
    },
    "headers": {
      "XRequestID": {
        "description": "Identifiant unique de la requête pour la corrélation des logs. Reprend le header `X-Request-ID` entrant si fourni, sinon génère un UUID v4.",
        "schema": {
          "type": "string",
          "format": "uuid",
          "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        }
      }
    },
    "responses": {
      "NotFound": {
        "description": "Todo introuvable",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "detail": "Todo not found"
            }
          }
        }
      },
      "ValidationError": {
        "description": "Échec de la validation de la requête",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ValidationError"
            }
          }
        }
      }
    }
  },
  "paths": {
    "/": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Racine de l'API",
        "description": "Retourne un message de bienvenue. Permet de vérifier rapidement que le serveur répond.",
        "operationId": "getRoot",
        "responses": {
          "200": {
            "description": "Serveur opérationnel",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "description": "Message de bienvenue statique",
                      "example": "Todo API"
                    }
                  }
                },
                "example": {
                  "message": "Todo API"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Health check",
        "description": "Retourne le statut de santé de l'application et l'uptime du processus en secondes.\nUtilisé par les load balancers et les outils de monitoring.\n",
        "operationId": "getHealth",
        "responses": {
          "200": {
            "description": "Application en bonne santé",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "description": "Toujours `ok` quand le serveur tourne",
                      "example": "ok"
                    },
                    "uptime": {
                      "type": "number",
                      "description": "Uptime du processus en secondes depuis le dernier redémarrage",
                      "example": 3723.8
                    }
                  }
                },
                "example": {
                  "status": "ok",
                  "uptime": 3723.8
                }
              }
            }
          }
        }
      }
    },
    "/telemetry": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Métriques Prometheus",
        "description": "Expose les métriques applicatives au format Prometheus (text/plain).\nScrappé par Prometheus et visualisé dans Grafana.\nInclut les métriques système (CPU, mémoire, event loop) et les compteurs HTTP.\n",
        "operationId": "getTelemetry",
        "responses": {
          "200": {
            "description": "Métriques au format Prometheus",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string",
                  "example": "# HELP http_requests_total Total number of HTTP requests\n# TYPE http_requests_total counter\nhttp_requests_total{method=\"GET\",route=\"/health\",status=\"200\"} 42\n"
                }
              }
            }
          }
        }
      }
    },
    "/todos/search": {
      "get": {
        "tags": [
          "Todos"
        ],
        "summary": "Rechercher des todos par titre",
        "description": "Effectue une recherche **insensible à la casse** sur le champ `title` avec une correspondance partielle (LIKE `%q%`).\n\nRetourne un tableau vide si aucun résultat — jamais un 404.\n\n**Exemples de recherche :**\n- `?q=buy` → trouve \"Buy groceries\", \"Buy milk\"\n- `?q=CALL` → trouve \"Call the dentist\" (insensible à la casse)\n- `?q=zzz` → `[]` si aucun match\n",
        "operationId": "searchTodos",
        "parameters": [
          {
            "in": "query",
            "name": "q",
            "required": true,
            "description": "Terme recherché dans les titres (1–200 caractères, insensible à la casse)",
            "schema": {
              "type": "string",
              "minLength": 1,
              "maxLength": 200,
              "example": "grocery"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste des todos dont le titre contient le terme recherché",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Todo"
                  }
                },
                "examples": {
                  "plusieursResultats": {
                    "summary": "Plusieurs résultats trouvés",
                    "value": [
                      {
                        "id": 1,
                        "title": "Buy groceries",
                        "description": "Oat milk, eggs",
                        "status": "pending"
                      },
                      {
                        "id": 5,
                        "title": "Buy milk",
                        "description": null,
                        "status": "done"
                      }
                    ]
                  },
                  "unResultat": {
                    "summary": "Un seul résultat",
                    "value": [
                      {
                        "id": 3,
                        "title": "Call the dentist",
                        "description": "Tuesday at 10am",
                        "status": "in-progress"
                      }
                    ]
                  },
                  "aucunResultat": {
                    "summary": "Aucun résultat (terme introuvable)",
                    "value": []
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètre `q` manquant ou trop court/long",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                },
                "examples": {
                  "manquant": {
                    "summary": "Paramètre q absent",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "q"
                          ],
                          "message": "Required"
                        }
                      ]
                    }
                  },
                  "tropCourt": {
                    "summary": "Paramètre q vide",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "q"
                          ],
                          "message": "String must contain at least 1 character(s)"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/todos": {
      "post": {
        "tags": [
          "Todos"
        ],
        "summary": "Créer un todo",
        "description": "Crée un nouveau todo et retourne l'objet persisté avec son `id` généré automatiquement.\n\n- `title` est le seul champ **obligatoire** (1–200 caractères).\n- `description` vaut `null` par défaut (max 1000 caractères).\n- `status` vaut `pending` par défaut.\n",
        "operationId": "createTodo",
        "requestBody": {
          "required": true,
          "description": "Données du todo. Seul `title` est obligatoire.",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTodoBody"
              },
              "examples": {
                "minimal": {
                  "summary": "Titre uniquement (cas minimal)",
                  "value": {
                    "title": "Read a book"
                  }
                },
                "avecDescription": {
                  "summary": "Titre + description",
                  "value": {
                    "title": "Prepare sprint review",
                    "description": "Slides, demo environment, metrics from last sprint"
                  }
                },
                "avecStatut": {
                  "summary": "Tâche déjà en cours",
                  "value": {
                    "title": "Refactor authentication module",
                    "description": "Extract JWT logic into a dedicated service",
                    "status": "in-progress"
                  }
                },
                "dejaDone": {
                  "summary": "Tâche créée comme terminée",
                  "value": {
                    "title": "Write unit tests for database module",
                    "status": "done"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Todo créé avec succès — retourne l'objet complet avec son `id`",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Todo"
                },
                "examples": {
                  "minimal": {
                    "summary": "Créé depuis un payload minimal",
                    "value": {
                      "id": 7,
                      "title": "Read a book",
                      "description": null,
                      "status": "pending"
                    }
                  },
                  "avecDescription": {
                    "summary": "Créé avec description",
                    "value": {
                      "id": 8,
                      "title": "Prepare sprint review",
                      "description": "Slides, demo environment, metrics from last sprint",
                      "status": "pending"
                    }
                  },
                  "enCours": {
                    "summary": "Créé en statut in-progress",
                    "value": {
                      "id": 9,
                      "title": "Refactor authentication module",
                      "description": "Extract JWT logic into a dedicated service",
                      "status": "in-progress"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Échec de validation — title manquant, trop long, ou status invalide",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                },
                "examples": {
                  "titleManquant": {
                    "summary": "title absent du body",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "title"
                          ],
                          "message": "title is required"
                        }
                      ]
                    }
                  },
                  "titleVide": {
                    "summary": "title vide",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "title"
                          ],
                          "message": "String must contain at least 1 character(s)"
                        }
                      ]
                    }
                  },
                  "statutInvalide": {
                    "summary": "status non reconnu",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "status"
                          ],
                          "message": "Invalid enum value. Expected 'pending' | 'in-progress' | 'done', received 'todo'"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Todos"
        ],
        "summary": "Lister les todos",
        "description": "Retourne un tableau paginé de tous les todos, triés par ordre d'insertion.\n\n**Pagination :**\n- `GET /todos` → page 1 (10 premiers)\n- `GET /todos?skip=0&limit=5` → 5 premiers\n- `GET /todos?skip=5&limit=5` → items 6 à 10\n- `GET /todos?skip=20&limit=100` → au plus 100 items à partir du 21ème\n\nRetourne `[]` si la base est vide ou si `skip` dépasse le nombre total.\n",
        "operationId": "listTodos",
        "parameters": [
          {
            "in": "query",
            "name": "skip",
            "description": "Nombre d'éléments à ignorer (offset). Défaut 0.",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0,
              "example": 0
            }
          },
          {
            "in": "query",
            "name": "limit",
            "description": "Nombre maximum d'éléments à retourner (1–100). Défaut 10.",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10,
              "example": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste paginée des todos (tableau vide si aucun ou si offset dépasse le total)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Todo"
                  }
                },
                "examples": {
                  "premierePage": {
                    "summary": "Première page — todos variés",
                    "value": [
                      {
                        "id": 1,
                        "title": "Buy groceries",
                        "description": "Oat milk, eggs",
                        "status": "pending"
                      },
                      {
                        "id": 2,
                        "title": "Call the dentist",
                        "description": "Tuesday at 10am",
                        "status": "in-progress"
                      },
                      {
                        "id": 3,
                        "title": "Write unit tests",
                        "description": null,
                        "status": "done"
                      }
                    ]
                  },
                  "pageVide": {
                    "summary": "Offset dépasse le total — retourne []",
                    "value": []
                  },
                  "baseVide": {
                    "summary": "Aucun todo en base",
                    "value": []
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres de pagination invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                },
                "examples": {
                  "limitTropEleve": {
                    "summary": "limit supérieur à 100",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "limit"
                          ],
                          "message": "Number must be less than or equal to 100"
                        }
                      ]
                    }
                  },
                  "limitNegatif": {
                    "summary": "limit inférieur à 1",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "limit"
                          ],
                          "message": "Number must be greater than or equal to 1"
                        }
                      ]
                    }
                  },
                  "skipNegatif": {
                    "summary": "skip négatif",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "skip"
                          ],
                          "message": "Number must be greater than or equal to 0"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/todos/{id}": {
      "get": {
        "tags": [
          "Todos"
        ],
        "summary": "Récupérer un todo par ID",
        "description": "Retourne un todo unique identifié par son `id` numérique.\n\nRetourne **404** si aucun todo ne correspond à cet ID.\n",
        "operationId": "getTodoById",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoId"
          }
        ],
        "responses": {
          "200": {
            "description": "Le todo demandé",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Todo"
                },
                "examples": {
                  "pending": {
                    "summary": "Todo en attente avec description",
                    "value": {
                      "id": 1,
                      "title": "Buy groceries",
                      "description": "Oat milk, eggs, sourdough",
                      "status": "pending"
                    }
                  },
                  "inProgress": {
                    "summary": "Todo en cours sans description",
                    "value": {
                      "id": 2,
                      "title": "Call the dentist",
                      "description": null,
                      "status": "in-progress"
                    }
                  },
                  "done": {
                    "summary": "Todo terminé",
                    "value": {
                      "id": 3,
                      "title": "Write unit tests",
                      "description": "Covers database and error handler modules",
                      "status": "done"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Aucun todo trouvé avec cet ID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "detail": "Todo not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Todos"
        ],
        "summary": "Mettre à jour un todo",
        "description": "Mise à jour partielle d'un todo existant (**sémantique PATCH**).\n\n- Les champs **omis** conservent leur valeur actuelle.\n- Passer `\"description\": null` pour **effacer** la description.\n- Retourne **404** si l'ID n'existe pas.\n- Retourne **400** si un champ fourni est invalide.\n",
        "operationId": "updateTodo",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoId"
          }
        ],
        "requestBody": {
          "required": true,
          "description": "Champs à mettre à jour. Au moins un champ doit être fourni.",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateTodoBody"
              },
              "examples": {
                "marquerFait": {
                  "summary": "Marquer comme terminé",
                  "value": {
                    "status": "done"
                  }
                },
                "mettreEnCours": {
                  "summary": "Démarrer une tâche",
                  "value": {
                    "status": "in-progress"
                  }
                },
                "renommer": {
                  "summary": "Renommer le todo",
                  "value": {
                    "title": "Buy organic groceries"
                  }
                },
                "effacerDescription": {
                  "summary": "Effacer la description (passer null)",
                  "value": {
                    "description": null
                  }
                },
                "ajouterDescription": {
                  "summary": "Ajouter une description à un todo qui n'en avait pas",
                  "value": {
                    "description": "Pick up from the farmers market on Saturday"
                  }
                },
                "miseAJourComplete": {
                  "summary": "Mettre à jour tous les champs en même temps",
                  "value": {
                    "title": "Buy organic groceries",
                    "description": "From the farmers market only",
                    "status": "in-progress"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Le todo après mise à jour",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Todo"
                },
                "examples": {
                  "marqueCommeTermine": {
                    "summary": "Todo passé à done",
                    "value": {
                      "id": 42,
                      "title": "Buy groceries",
                      "description": "Oat milk, eggs",
                      "status": "done"
                    }
                  },
                  "descriptionEffacee": {
                    "summary": "Description effacée (null)",
                    "value": {
                      "id": 42,
                      "title": "Buy groceries",
                      "description": null,
                      "status": "pending"
                    }
                  },
                  "miseAJourComplete": {
                    "summary": "Tous les champs mis à jour",
                    "value": {
                      "id": 42,
                      "title": "Buy organic groceries",
                      "description": "From the farmers market only",
                      "status": "in-progress"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation échouée sur un des champs fournis",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                },
                "examples": {
                  "titreVide": {
                    "summary": "title vide",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "title"
                          ],
                          "message": "String must contain at least 1 character(s)"
                        }
                      ]
                    }
                  },
                  "statutInvalide": {
                    "summary": "Valeur de status inconnue",
                    "value": {
                      "detail": [
                        {
                          "path": [
                            "status"
                          ],
                          "message": "Invalid enum value. Expected 'pending' | 'in-progress' | 'done', received 'completed'"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Aucun todo trouvé avec cet ID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "detail": "Todo not found"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Todos"
        ],
        "summary": "Supprimer un todo",
        "description": "Supprime **définitivement** un todo par son ID.\n\n⚠️ **Cette action est irréversible** — il n'existe pas de corbeille.\n\nRetourne **404** si l'ID n'existe pas (déjà supprimé ou jamais créé).\n",
        "operationId": "deleteTodo",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoId"
          }
        ],
        "responses": {
          "200": {
            "description": "Todo supprimé avec succès",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": {
                      "type": "string",
                      "description": "Message de confirmation",
                      "example": "Todo deleted"
                    }
                  }
                },
                "examples": {
                  "succes": {
                    "summary": "Suppression réussie",
                    "value": {
                      "detail": "Todo deleted"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Aucun todo trouvé avec cet ID (déjà supprimé ou inexistant)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "inexistant": {
                    "summary": "ID jamais créé",
                    "value": {
                      "detail": "Todo not found"
                    }
                  },
                  "dejaSuppr": {
                    "summary": "ID déjà supprimé",
                    "value": {
                      "detail": "Todo not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}